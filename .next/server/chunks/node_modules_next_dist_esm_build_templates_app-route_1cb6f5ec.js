module.exports=[899280,e=>{"use strict";var t=e.i(747909),n=e.i(174017),o=e.i(996250),s=e.i(759756),r=e.i(561916),i=e.i(114444),l=e.i(837092),a=e.i(869741),u=e.i(316795),d=e.i(487718),c=e.i(995169),p=e.i(47587),h=e.i(666012),m=e.i(570101),g=e.i(626937),f=e.i(10372),v=e.i(193695);e.i(52474);var y=e.i(600220),b=e.i(975789),_=e.i(62789);e.i(274444);var k=e.i(410584);function z(e){var t,n;return null!=(n=null==(t=null==e?void 0:e.providerOptions)?void 0:t.openaiCompatible)?n:{}}function w({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function T(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var R=k.z.object({user:k.z.string().optional(),reasoningEffort:k.z.string().optional(),textVerbosity:k.z.string().optional()}),x={errorSchema:k.z.object({error:k.z.object({message:k.z.string(),type:k.z.string().nullish(),param:k.z.any().nullish(),code:k.z.union([k.z.string(),k.z.number()]).nullish()})}),errorToMessage:e=>e.error.message},E=class{constructor(e,t){var n,o;this.specificationVersion="v2",this.modelId=e,this.config=t;const s=null!=(n=t.errorStructure)?n:x;this.chunkSchema=C(s.errorSchema),this.failedResponseHandler=(0,_.createJsonErrorResponseHandler)(s),this.supportsStructuredOutputs=null!=(o=t.supportsStructuredOutputs)&&o}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var e,t,n;return null!=(n=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?n:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:o,topK:s,frequencyPenalty:r,presencePenalty:i,providerOptions:l,stopSequences:a,responseFormat:u,seed:d,toolChoice:c,tools:p}){var h,m,g,f;let v=[],y=Object.assign(null!=(h=await (0,_.parseProviderOptions)({provider:"openai-compatible",providerOptions:l,schema:R}))?h:{},null!=(m=await (0,_.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:l,schema:R}))?m:{});null!=s&&v.push({type:"unsupported-setting",setting:"topK"}),(null==u?void 0:u.type)!=="json"||null==u.schema||this.supportsStructuredOutputs||v.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let{tools:k,toolChoice:w,toolWarnings:T}=function({tools:e,toolChoice:t}){e=(null==e?void 0:e.length)?e:void 0;let n=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let o=[];for(let t of e)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):o.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(null==t)return{tools:o,toolChoice:void 0,toolWarnings:n};let s=t.type;switch(s){case"auto":case"none":case"required":return{tools:o,toolChoice:s,toolWarnings:n};case"tool":return{tools:o,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:throw new b.UnsupportedFunctionalityError({functionality:`tool choice type: ${s}`})}}({tools:p,toolChoice:c});return{args:{model:this.modelId,user:y.user,max_tokens:t,temperature:n,top_p:o,frequency_penalty:r,presence_penalty:i,response_format:(null==u?void 0:u.type)==="json"?!0===this.supportsStructuredOutputs&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,name:null!=(g=u.name)?g:"response",description:u.description}}:{type:"json_object"}:void 0,stop:a,seed:d,...Object.fromEntries(Object.entries(null!=(f=null==l?void 0:l[this.providerOptionsName])?f:{}).filter(([e])=>!Object.keys(R.shape).includes(e))),reasoning_effort:y.reasoningEffort,verbosity:y.textVerbosity,messages:function(e){let t=[];for(let{role:n,content:o,...s}of e){let e=z({...s});switch(n){case"system":t.push({role:"system",content:o,...e});break;case"user":if(1===o.length&&"text"===o[0].type){t.push({role:"user",content:o[0].text,...z(o[0])});break}t.push({role:"user",content:o.map(e=>{let t=z(e);switch(e.type){case"text":return{type:"text",text:e.text,...t};case"file":if(e.mediaType.startsWith("image/")){let n="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${n};base64,${(0,_.convertToBase64)(e.data)}`},...t}}throw new b.UnsupportedFunctionalityError({functionality:`file part media type ${e.mediaType}`})}}),...e});break;case"assistant":{let n="",s=[];for(let e of o){let t=z(e);switch(e.type){case"text":n+=e.text;break;case"tool-call":s.push({id:e.toolCallId,type:"function",function:{name:e.toolName,arguments:JSON.stringify(e.input)},...t})}}t.push({role:"assistant",content:n,tool_calls:s.length>0?s:void 0,...e});break}case"tool":for(let e of o){let n,o=e.output;switch(o.type){case"text":case"error-text":n=o.value;break;case"content":case"json":case"error-json":n=JSON.stringify(o.value)}let s=z(e);t.push({role:"tool",tool_call_id:e.toolCallId,content:n,...s})}break;default:throw Error(`Unsupported role: ${n}`)}}return t}(e),tools:k,tool_choice:w},warnings:[...v,...T]}}async doGenerate(e){var t,n,o,s,r,i,l,a,u,d,c,p,h,m,g,f,v;let{args:y,warnings:b}=await this.getArgs({...e}),k=JSON.stringify(y),{responseHeaders:z,value:R,rawValue:x}=await (0,_.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,_.combineHeaders)(this.config.headers(),e.headers),body:y,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,_.createJsonResponseHandler)(j),abortSignal:e.abortSignal,fetch:this.config.fetch}),E=R.choices[0],S=[],C=E.message.content;null!=C&&C.length>0&&S.push({type:"text",text:C});let I=null!=(t=E.message.reasoning_content)?t:E.message.reasoning;if(null!=I&&I.length>0&&S.push({type:"reasoning",text:I}),null!=E.message.tool_calls)for(let e of E.message.tool_calls)S.push({type:"tool-call",toolCallId:null!=(n=e.id)?n:(0,_.generateId)(),toolName:e.function.name,input:e.function.arguments});let O={[this.providerOptionsName]:{},...await (null==(s=null==(o=this.config.metadataExtractor)?void 0:o.extractMetadata)?void 0:s.call(o,{parsedBody:x}))},P=null==(r=R.usage)?void 0:r.completion_tokens_details;return(null==P?void 0:P.accepted_prediction_tokens)!=null&&(O[this.providerOptionsName].acceptedPredictionTokens=null==P?void 0:P.accepted_prediction_tokens),(null==P?void 0:P.rejected_prediction_tokens)!=null&&(O[this.providerOptionsName].rejectedPredictionTokens=null==P?void 0:P.rejected_prediction_tokens),{content:S,finishReason:T(E.finish_reason),usage:{inputTokens:null!=(l=null==(i=R.usage)?void 0:i.prompt_tokens)?l:void 0,outputTokens:null!=(u=null==(a=R.usage)?void 0:a.completion_tokens)?u:void 0,totalTokens:null!=(c=null==(d=R.usage)?void 0:d.total_tokens)?c:void 0,reasoningTokens:null!=(m=null==(h=null==(p=R.usage)?void 0:p.completion_tokens_details)?void 0:h.reasoning_tokens)?m:void 0,cachedInputTokens:null!=(v=null==(f=null==(g=R.usage)?void 0:g.prompt_tokens_details)?void 0:f.cached_tokens)?v:void 0},providerMetadata:O,request:{body:k},response:{...w(R),headers:z,body:x},warnings:b}}async doStream(e){var t;let{args:n,warnings:o}=await this.getArgs({...e}),s={...n,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0},r=null==(t=this.config.metadataExtractor)?void 0:t.createStreamExtractor(),{responseHeaders:i,value:l}=await (0,_.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,_.combineHeaders)(this.config.headers(),e.headers),body:s,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,_.createEventSourceResponseHandler)(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch}),a=[],u="unknown",d={completionTokens:void 0,completionTokensDetails:{reasoningTokens:void 0,acceptedPredictionTokens:void 0,rejectedPredictionTokens:void 0},promptTokens:void 0,promptTokensDetails:{cachedTokens:void 0},totalTokens:void 0},c=!0,p=this.providerOptionsName,h=!1,m=!1;return{stream:l.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,n){var o,s,i,l,p,g,f,v,y,k,z,R,x;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){u="error",n.enqueue({type:"error",error:t.error});return}let E=t.value;if(null==r||r.processChunk(t.rawValue),"error"in E){u="error",n.enqueue({type:"error",error:E.error.message});return}if(c&&(c=!1,n.enqueue({type:"response-metadata",...w(E)})),null!=E.usage){let{prompt_tokens:e,completion_tokens:t,total_tokens:n,prompt_tokens_details:o,completion_tokens_details:s}=E.usage;d.promptTokens=null!=e?e:void 0,d.completionTokens=null!=t?t:void 0,d.totalTokens=null!=n?n:void 0,(null==s?void 0:s.reasoning_tokens)!=null&&(d.completionTokensDetails.reasoningTokens=null==s?void 0:s.reasoning_tokens),(null==s?void 0:s.accepted_prediction_tokens)!=null&&(d.completionTokensDetails.acceptedPredictionTokens=null==s?void 0:s.accepted_prediction_tokens),(null==s?void 0:s.rejected_prediction_tokens)!=null&&(d.completionTokensDetails.rejectedPredictionTokens=null==s?void 0:s.rejected_prediction_tokens),(null==o?void 0:o.cached_tokens)!=null&&(d.promptTokensDetails.cachedTokens=null==o?void 0:o.cached_tokens)}let S=E.choices[0];if((null==S?void 0:S.finish_reason)!=null&&(u=T(S.finish_reason)),(null==S?void 0:S.delta)==null)return;let j=S.delta,C=null!=(o=j.reasoning_content)?o:j.reasoning;if(C&&(h||(n.enqueue({type:"reasoning-start",id:"reasoning-0"}),h=!0),n.enqueue({type:"reasoning-delta",id:"reasoning-0",delta:C})),j.content&&(m||(n.enqueue({type:"text-start",id:"txt-0"}),m=!0),n.enqueue({type:"text-delta",id:"txt-0",delta:j.content})),null!=j.tool_calls)for(let e of j.tool_calls){let t=e.index;if(null==a[t]){if(null==e.id)throw new b.InvalidResponseDataError({data:e,message:"Expected 'id' to be a string."});if((null==(s=e.function)?void 0:s.name)==null)throw new b.InvalidResponseDataError({data:e,message:"Expected 'function.name' to be a string."});n.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),a[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(i=e.function.arguments)?i:""},hasFinished:!1};let o=a[t];(null==(l=o.function)?void 0:l.name)!=null&&(null==(p=o.function)?void 0:p.arguments)!=null&&(o.function.arguments.length>0&&n.enqueue({type:"tool-input-delta",id:o.id,delta:o.function.arguments}),(0,_.isParsableJson)(o.function.arguments)&&(n.enqueue({type:"tool-input-end",id:o.id}),n.enqueue({type:"tool-call",toolCallId:null!=(g=o.id)?g:(0,_.generateId)(),toolName:o.function.name,input:o.function.arguments}),o.hasFinished=!0));continue}let o=a[t];!o.hasFinished&&((null==(f=e.function)?void 0:f.arguments)!=null&&(o.function.arguments+=null!=(y=null==(v=e.function)?void 0:v.arguments)?y:""),n.enqueue({type:"tool-input-delta",id:o.id,delta:null!=(k=e.function.arguments)?k:""}),(null==(z=o.function)?void 0:z.name)!=null&&(null==(R=o.function)?void 0:R.arguments)!=null&&(0,_.isParsableJson)(o.function.arguments)&&(n.enqueue({type:"tool-input-end",id:o.id}),n.enqueue({type:"tool-call",toolCallId:null!=(x=o.id)?x:(0,_.generateId)(),toolName:o.function.name,input:o.function.arguments}),o.hasFinished=!0))}},flush(e){var t,n,o,s,i,l;for(let n of(h&&e.enqueue({type:"reasoning-end",id:"reasoning-0"}),m&&e.enqueue({type:"text-end",id:"txt-0"}),a.filter(e=>!e.hasFinished)))e.enqueue({type:"tool-input-end",id:n.id}),e.enqueue({type:"tool-call",toolCallId:null!=(t=n.id)?t:(0,_.generateId)(),toolName:n.function.name,input:n.function.arguments});let c={[p]:{},...null==r?void 0:r.buildMetadata()};null!=d.completionTokensDetails.acceptedPredictionTokens&&(c[p].acceptedPredictionTokens=d.completionTokensDetails.acceptedPredictionTokens),null!=d.completionTokensDetails.rejectedPredictionTokens&&(c[p].rejectedPredictionTokens=d.completionTokensDetails.rejectedPredictionTokens),e.enqueue({type:"finish",finishReason:u,usage:{inputTokens:null!=(n=d.promptTokens)?n:void 0,outputTokens:null!=(o=d.completionTokens)?o:void 0,totalTokens:null!=(s=d.totalTokens)?s:void 0,reasoningTokens:null!=(i=d.completionTokensDetails.reasoningTokens)?i:void 0,cachedInputTokens:null!=(l=d.promptTokensDetails.cachedTokens)?l:void 0},providerMetadata:c})}})),request:{body:s},response:{headers:i}}}},S=k.z.object({prompt_tokens:k.z.number().nullish(),completion_tokens:k.z.number().nullish(),total_tokens:k.z.number().nullish(),prompt_tokens_details:k.z.object({cached_tokens:k.z.number().nullish()}).nullish(),completion_tokens_details:k.z.object({reasoning_tokens:k.z.number().nullish(),accepted_prediction_tokens:k.z.number().nullish(),rejected_prediction_tokens:k.z.number().nullish()}).nullish()}).nullish(),j=k.z.object({id:k.z.string().nullish(),created:k.z.number().nullish(),model:k.z.string().nullish(),choices:k.z.array(k.z.object({message:k.z.object({role:k.z.literal("assistant").nullish(),content:k.z.string().nullish(),reasoning_content:k.z.string().nullish(),reasoning:k.z.string().nullish(),tool_calls:k.z.array(k.z.object({id:k.z.string().nullish(),function:k.z.object({name:k.z.string(),arguments:k.z.string()})})).nullish()}),finish_reason:k.z.string().nullish()})),usage:S}),C=e=>k.z.union([k.z.object({id:k.z.string().nullish(),created:k.z.number().nullish(),model:k.z.string().nullish(),choices:k.z.array(k.z.object({delta:k.z.object({role:k.z.enum(["assistant"]).nullish(),content:k.z.string().nullish(),reasoning_content:k.z.string().nullish(),reasoning:k.z.string().nullish(),tool_calls:k.z.array(k.z.object({index:k.z.number(),id:k.z.string().nullish(),function:k.z.object({name:k.z.string().nullish(),arguments:k.z.string().nullish()})})).nullish()}).nullish(),finish_reason:k.z.string().nullish()})),usage:S}),e]);function I({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function O(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var P=k.z.object({echo:k.z.boolean().optional(),logitBias:k.z.record(k.z.string(),k.z.number()).optional(),suffix:k.z.string().optional(),user:k.z.string().optional()}),q=class{constructor(e,t){var n;this.specificationVersion="v2",this.modelId=e,this.config=t;const o=null!=(n=t.errorStructure)?n:x;this.chunkSchema=A(o.errorSchema),this.failedResponseHandler=(0,_.createJsonErrorResponseHandler)(o)}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var e,t,n;return null!=(n=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?n:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:o,topK:s,frequencyPenalty:r,presencePenalty:i,stopSequences:l,responseFormat:a,seed:u,providerOptions:d,tools:c,toolChoice:p}){var h;let m=[],g=null!=(h=await (0,_.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:d,schema:P}))?h:{};null!=s&&m.push({type:"unsupported-setting",setting:"topK"}),(null==c?void 0:c.length)&&m.push({type:"unsupported-setting",setting:"tools"}),null!=p&&m.push({type:"unsupported-setting",setting:"toolChoice"}),null!=a&&"text"!==a.type&&m.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:f,stopSequences:v}=function({prompt:e,user:t="user",assistant:n="assistant"}){let o="";for(let{role:s,content:r}of("system"===e[0].role&&(o+=`${e[0].content}

`,e=e.slice(1)),e))switch(s){case"system":throw new b.InvalidPromptError({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=r.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("");o+=`${t}:
${e}

`;break}case"assistant":{let e=r.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new b.UnsupportedFunctionalityError({functionality:"tool-call messages"})}}).join("");o+=`${n}:
${e}

`;break}case"tool":throw new b.UnsupportedFunctionalityError({functionality:"tool messages"});default:throw Error(`Unsupported role: ${s}`)}return{prompt:o+=`${n}:
`,stopSequences:[`
${t}:`]}}({prompt:e}),y=[...null!=v?v:[],...null!=l?l:[]];return{args:{model:this.modelId,echo:g.echo,logit_bias:g.logitBias,suffix:g.suffix,user:g.user,max_tokens:t,temperature:n,top_p:o,frequency_penalty:r,presence_penalty:i,seed:u,...null==d?void 0:d[this.providerOptionsName],prompt:f,stop:y.length>0?y:void 0},warnings:m}}async doGenerate(e){var t,n,o,s,r,i;let{args:l,warnings:a}=await this.getArgs(e),{responseHeaders:u,value:d,rawValue:c}=await (0,_.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,_.combineHeaders)(this.config.headers(),e.headers),body:l,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,_.createJsonResponseHandler)(N),abortSignal:e.abortSignal,fetch:this.config.fetch}),p=d.choices[0],h=[];return null!=p.text&&p.text.length>0&&h.push({type:"text",text:p.text}),{content:h,usage:{inputTokens:null!=(n=null==(t=d.usage)?void 0:t.prompt_tokens)?n:void 0,outputTokens:null!=(s=null==(o=d.usage)?void 0:o.completion_tokens)?s:void 0,totalTokens:null!=(i=null==(r=d.usage)?void 0:r.total_tokens)?i:void 0},finishReason:O(p.finish_reason),request:{body:l},response:{...I(d),headers:u,body:c},warnings:a}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),o={...t,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0},{responseHeaders:s,value:r}=await (0,_.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,_.combineHeaders)(this.config.headers(),e.headers),body:o,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,_.createEventSourceResponseHandler)(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch}),i="unknown",l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},a=!0;return{stream:r.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var o,s,r;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){i="error",n.enqueue({type:"error",error:t.error});return}let u=t.value;if("error"in u){i="error",n.enqueue({type:"error",error:u.error});return}a&&(a=!1,n.enqueue({type:"response-metadata",...I(u)}),n.enqueue({type:"text-start",id:"0"})),null!=u.usage&&(l.inputTokens=null!=(o=u.usage.prompt_tokens)?o:void 0,l.outputTokens=null!=(s=u.usage.completion_tokens)?s:void 0,l.totalTokens=null!=(r=u.usage.total_tokens)?r:void 0);let d=u.choices[0];(null==d?void 0:d.finish_reason)!=null&&(i=O(d.finish_reason)),(null==d?void 0:d.text)!=null&&n.enqueue({type:"text-delta",id:"0",delta:d.text})},flush(e){a||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:i,usage:l})}})),request:{body:o},response:{headers:s}}}},H=k.z.object({prompt_tokens:k.z.number(),completion_tokens:k.z.number(),total_tokens:k.z.number()}),N=k.z.object({id:k.z.string().nullish(),created:k.z.number().nullish(),model:k.z.string().nullish(),choices:k.z.array(k.z.object({text:k.z.string(),finish_reason:k.z.string()})),usage:H.nullish()}),A=e=>k.z.union([k.z.object({id:k.z.string().nullish(),created:k.z.number().nullish(),model:k.z.string().nullish(),choices:k.z.array(k.z.object({text:k.z.string(),finish_reason:k.z.string().nullish(),index:k.z.number()})),usage:H.nullish()}),e]),U=k.z.object({dimensions:k.z.number().optional(),user:k.z.string().optional()}),M=class{constructor(e,t){this.specificationVersion="v2",this.modelId=e,this.config=t}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.config.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.config.supportsParallelCalls)||e}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:o}){var s,r,i;let l=Object.assign(null!=(s=await (0,_.parseProviderOptions)({provider:"openai-compatible",providerOptions:o,schema:U}))?s:{},null!=(r=await (0,_.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:o,schema:U}))?r:{});if(e.length>this.maxEmbeddingsPerCall)throw new b.TooManyEmbeddingValuesForCallError({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:u,rawValue:d}=await (0,_.postJsonToApi)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,_.combineHeaders)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:l.dimensions,user:l.user},failedResponseHandler:(0,_.createJsonErrorResponseHandler)(null!=(i=this.config.errorStructure)?i:x),successfulResponseHandler:(0,_.createJsonResponseHandler)(D),abortSignal:n,fetch:this.config.fetch});return{embeddings:u.data.map(e=>e.embedding),usage:u.usage?{tokens:u.usage.prompt_tokens}:void 0,providerMetadata:u.providerMetadata,response:{headers:a,body:d}}}},D=k.z.object({data:k.z.array(k.z.object({embedding:k.z.array(k.z.number())})),usage:k.z.object({prompt_tokens:k.z.number()}).nullish(),providerMetadata:k.z.record(k.z.string(),k.z.record(k.z.string(),k.z.any())).optional()}),$=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxImagesPerCall=10}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:o,seed:s,providerOptions:r,headers:i,abortSignal:l}){var a,u,d,c,p;let h=[];null!=o&&h.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=s&&h.push({type:"unsupported-setting",setting:"seed"});let m=null!=(d=null==(u=null==(a=this.config._internal)?void 0:a.currentDate)?void 0:u.call(a))?d:new Date,{value:g,responseHeaders:f}=await (0,_.postJsonToApi)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,_.combineHeaders)(this.config.headers(),i),body:{model:this.modelId,prompt:e,n:t,size:n,...null!=(c=r.openai)?c:{},response_format:"b64_json"},failedResponseHandler:(0,_.createJsonErrorResponseHandler)(null!=(p=this.config.errorStructure)?p:x),successfulResponseHandler:(0,_.createJsonResponseHandler)(J),abortSignal:l,fetch:this.config.fetch});return{images:g.data.map(e=>e.b64_json),warnings:h,response:{timestamp:m,modelId:this.modelId,headers:f}}}},J=k.z.object({data:k.z.array(k.z.object({b64_json:k.z.string()}))}),F=e.i(712075),V=e.i(89171);async function K(e){let t=(()=>{var e;let t,n,o,s,r,i,l,a,u=process.env.NIM_API_KEY;if(!u)return null;if(globalThis.__nimClient&&globalThis.__nimApiKey===u)return globalThis.__nimClient;let d=(e={name:"nim",baseURL:"https://integrate.api.nvidia.com/v1",headers:{Authorization:`Bearer ${u}`}},t=(0,_.withoutTrailingSlash)(e.baseURL),n=e.name,o={...e.apiKey&&{Authorization:`Bearer ${e.apiKey}`},...e.headers},s=()=>(0,_.withUserAgentSuffix)(o,"ai-sdk/openai-compatible/1.0.25"),r=o=>({provider:`${n}.${o}`,url:({path:n})=>{let o=new URL(`${t}${n}`);return e.queryParams&&(o.search=new URLSearchParams(e.queryParams).toString()),o.toString()},headers:s,fetch:e.fetch}),i=e=>l(e),l=t=>new E(t,{...r("chat"),includeUsage:e.includeUsage,supportsStructuredOutputs:e.supportsStructuredOutputs}),(a=e=>i(e)).languageModel=i,a.chatModel=l,a.completionModel=t=>new q(t,{...r("completion"),includeUsage:e.includeUsage}),a.textEmbeddingModel=e=>new M(e,{...r("embedding")}),a.imageModel=e=>new $(e,r("image")),a);return globalThis.__nimClient=d,globalThis.__nimApiKey=u,d})();if(!t)return V.NextResponse.json({error:"NIM_API_KEY is not configured"},{status:500});let{messages:n}=await e.json();return(await (0,F.streamText)({model:t.chatModel("moonshotai/kimi-k2-instruct-0905"),system:"You are a helpful assistant.",messages:(0,F.convertToModelMessages)(n)})).toUIMessageStreamResponse()}e.s(["POST",()=>K],1351);var B=e.i(1351);let L=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/chat/route.ts",nextConfigOutput:"",userland:B}),{workAsyncStorage:G,workUnitAsyncStorage:W,serverHooks:X}=L;function Y(){return(0,o.patchFetch)({workAsyncStorage:G,workUnitAsyncStorage:W})}async function Z(e,t,o){L.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let b="/api/chat/route";b=b.replace(/\/index$/,"")||"/";let _=await L.prepare(e,t,{srcPage:b,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:k,params:z,nextConfig:w,parsedUrl:T,isDraftMode:R,prerenderManifest:x,routerServerContext:E,isOnDemandRevalidate:S,revalidateOnlyGenerated:j,resolvedPathname:C,clientReferenceManifest:I,serverActionsManifest:O}=_,P=(0,a.normalizeAppPath)(b),q=!!(x.dynamicRoutes[P]||x.routes[C]),H=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,T,!1):t.end("This page could not be found"),null);if(q&&!R){let e=!!x.routes[C],t=x.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await H();throw new v.NoFallbackError}}let N=null;!q||L.isDev||R||(N="/index"===(N=C)?"/":N);let A=!0===L.isDev||!q,U=q&&!A;O&&I&&(0,i.setReferenceManifestsSingleton)({page:b,clientReferenceManifest:I,serverActionsManifest:O,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:O})});let M=e.method||"GET",D=(0,r.getTracer)(),$=D.getActiveScopeSpan(),J={params:z,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:A,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,o)=>L.onRequestError(e,t,o,E)},sharedContext:{buildId:k}},F=new u.NodeNextRequest(e),V=new u.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let i=async e=>L.handle(K,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=D.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=n.get("next.route");if(o){let t=`${M} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${b}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),a=async s=>{var r,a;let u=async({previousCacheEntry:n})=>{try{if(!l&&S&&j&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await i(s);e.fetchMetrics=J.renderOpts.fetchMetrics;let a=J.renderOpts.pendingWaitUntil;a&&o.waitUntil&&(o.waitUntil(a),a=void 0);let u=J.renderOpts.collectedTags;if(!q)return await (0,h.sendResponse)(F,V,r,J.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(r.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,o=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==n?void 0:n.isStale)&&await L.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:S})},E),t}},d=await L.handleResponse({req:e,nextConfig:w,cacheKey:N,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:j,responseGenerator:u,waitUntil:o.waitUntil,isMinimalMode:l});if(!q)return null;if((null==d||null==(r=d.value)?void 0:r.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(a=d.value)?void 0:a.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",S?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&q||c.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(F,V,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};$?await a($):await D.withPropagatedContext(e.headers,()=>D.trace(c.BaseServerSpan.handleRequest,{spanName:`${M} ${b}`,kind:r.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},a))}catch(t){if(t instanceof v.NoFallbackError||await L.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:S})}),q)throw t;return await (0,h.sendResponse)(F,V,new Response(null,{status:500})),null}}e.s(["handler",()=>Z,"patchFetch",()=>Y,"routeModule",()=>L,"serverHooks",()=>X,"workAsyncStorage",()=>G,"workUnitAsyncStorage",()=>W],899280)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_1cb6f5ec.js.map