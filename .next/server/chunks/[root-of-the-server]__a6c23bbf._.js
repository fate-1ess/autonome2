module.exports=[738967,e=>{"use strict";new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2});let t=["BTC","ETH","SOL"];e.s(["normalizeNumber",0,e=>{if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e&&e.length>0){let t=Number.parseFloat(e);return Number.isFinite(t)?t:null}return null},"parseSymbols",0,e=>{if(!e)return[...t];let r=new Set;return e.split(",").map(e=>e.trim().toUpperCase()).filter(Boolean).forEach(e=>r.add(e)),r.size>0?Array.from(r):[...t]}])},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},35344,e=>{"use strict";var t=e.i(29173);let r=globalThis.prisma??new t.PrismaClient;e.s(["prisma",0,r])},288840,e=>{"use strict";e.s(["getArray",0,e=>Array.isArray(e)?e:[],"safeJsonParse",0,(e,t)=>{if(!e)return t;try{return JSON.parse(e)??t}catch{return t}}])},476591,e=>{"use strict";let t={LONG:"LONG",SHORT:"SHORT",HOLD:"HOLD"},r=e=>{if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e&&e.trim().length>0){let t=Number.parseFloat(e);return Number.isFinite(t)?t:null}return null},n=e=>{if("string"==typeof e){let t=e.trim();return t.length>0?t:null}return"number"==typeof e&&Number.isFinite(e)?e.toString():null},i=e=>{let t=n(e);return t?t.toUpperCase():null},a=(e,a)=>{if("object"!=typeof e||null===e)return null;let o=i(e.symbol??e.market??a);if(!o)return null;let l=(e=>{let r=n(e);if(!r)return null;let i=r.toUpperCase();return i in t?t[i]:null})(e.signal??e.side??e.action);if(!l)return null;let s=r(e.quantity??e.size??e.notional??e.amount),u=r(e.leverage??e.leverageRatio),c=r(e.profitTarget??e.target??e.profit_target),d=r(e.stopLoss??e.stop??e.stop_loss),p=n(e.invalidationCondition??e.invalidCondition??e.invalid_condition??e.invalidation_condition)??null;return{symbol:o,signal:l,quantity:s,leverage:u,profitTarget:c,stopLoss:d,invalidationCondition:p,confidence:r(e.confidence??e.confidenceScore??e.confidence_percent??e.confidence_percentage),status:n(e.status??e.executionStatus??e.execution_status)??null}},o=(e,t)=>{if("object"!=typeof e||null===e)return null;let r=i(e.symbol??t);if(!r)return null;let a=e.success??e.ok??e.executed;return{symbol:r,success:"boolean"==typeof a?a:1===a||"true"===a,error:n(e.error??e.reason??e.message)??null}},l=e=>{if("object"!=typeof e||null===e)return{decisions:[],results:[],raw:e};let t=[];for(let r of(e=>{let t=[];for(let r of["decisions","positions","actions","entries","closedPositions","signals"]){let n=e[r];Array.isArray(n)&&t.push(n)}return t})(e))if(Array.isArray(r))for(let e of r){let r=a(e);r&&t.push(r)}if(0===t.length){let r=a(e);r&&t.push(r)}let r=[];for(let t of(e=>{let t=[];for(let r of["results","executions","outcomes","closedPositions"]){let n=e[r];Array.isArray(n)&&t.push(n)}return t})(e))if(Array.isArray(t))for(let e of t){let t=o(e);t&&r.push(t)}return{decisions:t,results:r,raw:e}};e.s(["buildDecisionIndex",0,e=>{let t=new Map;for(let r of e){let e=l(r.metadata);if(!e.decisions.length)continue;let n=new Map;for(let t of e.results)n.set(t.symbol,t);for(let i of e.decisions){let e=i.symbol;!e||t.has(e)||t.set(e,{...i,toolCallId:r.id,createdAt:r.createdAt,toolCallType:r.toolCallType,result:n.get(e)??null})}}return t},"parseTradingToolCallMetadata",0,l])},78468,e=>{"use strict";var t=e.i(122458);e.s(["AccountApi",()=>t.PromiseAccountApi])},928214,e=>{"use strict";e.i(608808);var t=e.i(78468),r=e.i(274828),n=e.i(972172),i=e.i(218936),a=e.i(798003),o=e.i(188241);let l=e=>{if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){let t=Number.parseFloat(e);return Number.isFinite(t)?t:null}return null};async function s(e){let t=await o.ExchangeSimulator.bootstrap(a.DEFAULT_SIMULATOR_OPTIONS),r=e&&e.length>0?e:"default";return t.getOpenPositions(r).map(e=>{let t=e.quantity,r=e.avgEntryPrice??null,n=Number.isFinite(e.notional)?e.notional:null!=r?r*Math.abs(t):null!=e.markPrice?e.markPrice*Math.abs(t):null,i=null!=e.leverage&&Number.isFinite(e.leverage)?e.leverage:void 0;return{symbol:e.symbol,position:e.quantity.toFixed(4),quantity:t,sign:e.side,unrealizedPnl:e.unrealizedPnl.toFixed(2),realizedPnl:e.realizedPnl.toFixed(2),liquidationPrice:null,leverage:i,notional:null!=n?n.toFixed(2):void 0,entryPrice:r,markPrice:e.markPrice??null,exitPlan:null,confidence:null,signal:e.side,lastDecisionAt:null,decisionStatus:null}})}async function u(e,o,u,c){let d=c?.fallbackToSimulator??!1;if(a.IS_SIMULATION_ENABLED)return s(u);if(!e||0===e.trim().length){if(d)return console.warn(`[openPositions] Missing API key for account ${o}; using simulator fallback.`),s(u);throw Error(`Missing API key for account index ${o}`)}let p=new t.AccountApi({baseServer:new i.ServerConfiguration(a.BASE_URL,{}),httpApi:new n.IsomorphicFetchHttpLibrary,middleware:[],authMethods:{apiKey:new r.ApiKeyAuthentication(e)}});try{let e=await p.accountWithHttpInfo("index",o);return(e.data.accounts[0]?.positions??[]).map(e=>{let t=l(e.position)??0,r=l(e.avgEntryPrice),n=l(e.positionValue),i=null!=n&&0!==t?n/Math.abs(t):l(e.avgEntryPrice);return{symbol:e.symbol,position:e.position,quantity:t,sign:1===e.sign?"LONG":"SHORT",unrealizedPnl:e.unrealizedPnl,realizedPnl:e.realizedPnl,liquidationPrice:e.liquidationPrice,leverage:void 0,notional:e.positionValue,entryPrice:r,markPrice:i,exitPlan:null,confidence:null,signal:1===e.sign?"LONG":"SHORT",lastDecisionAt:null,decisionStatus:null}})}catch(e){if(d)return console.warn(`[openPositions] Failed to load live positions for account ${o}, using simulator fallback`,e instanceof Error?e.message:e),s(u);throw e}}e.s(["getOpenPositions",()=>u])},569867,e=>{"use strict";e.i(608808);var t=e.i(78468),r=e.i(274828),n=e.i(972172),i=e.i(218936),a=e.i(798003),o=e.i(188241);let l=e=>{if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e&&e.trim().length>0){let t=Number.parseFloat(e);return Number.isFinite(t)?t:null}return null};async function s(e){let t=await o.ExchangeSimulator.bootstrap(a.DEFAULT_SIMULATOR_OPTIONS),r=e.id||"default",n=t.getAccountSnapshot(r),i=Number.isFinite(n.equity)?n.equity:0,l=Number.isFinite(n.availableCash)?n.availableCash:void 0,s=Math.min(n.cashBalance,i),u=Math.max(l??s,0);return{totalValue:i,availableCash:u,total:i.toFixed(2),available:u.toFixed(2)}}async function u(e,o){let u=o?.fallbackToSimulator??!1;if(a.IS_SIMULATION_ENABLED)return s(e);if(!e.apiKey||0===e.apiKey.trim().length){if(u)return console.warn(`[getPortfolio] Missing API key for account ${e.accountIndex}; using simulator fallback.`),s(e);throw Error(`Missing API key for account index ${e.accountIndex}`)}let c=new t.AccountApi({baseServer:new i.ServerConfiguration(a.BASE_URL,{}),httpApi:new n.IsomorphicFetchHttpLibrary,middleware:[],authMethods:{apiKey:new r.ApiKeyAuthentication(e.apiKey)}});try{let t=await c.accountWithHttpInfo("index",e.accountIndex),r=t.data?.accounts?.[0]??{},n=l(r.totalAssetValue??r.total_asset_value??r.total)??0,i=l(r.availableBalance??r.available_balance??r.available),a=n>0&&null!=i?Math.min(i,n):i??n,o=Math.max(a??0,0);return{totalValue:n,availableCash:o,total:n.toFixed(2),available:o.toFixed(2)}}catch(t){if(u)return console.warn(`[getPortfolio] Failed to fetch live portfolio for account ${e.accountIndex}, using simulator fallback`,t instanceof Error?t.message:t),s(e);throw t}}e.s(["getPortfolio",()=>u])},387849,e=>{"use strict";var t=e.i(747909),r=e.i(174017),n=e.i(996250),i=e.i(759756),a=e.i(561916),o=e.i(114444),l=e.i(837092),s=e.i(869741),u=e.i(316795),c=e.i(487718),d=e.i(995169),p=e.i(47587),f=e.i(666012),m=e.i(570101),h=e.i(626937),g=e.i(10372),y=e.i(193695);e.i(52474);var v=e.i(600220),b=e.i(89171),x=e.i(29173),A=e.i(928214),R=e.i(569867),w=e.i(476591),E=e.i(35344),P=e.i(288840),C=e.i(738967);async function N(){return Promise.all((await E.prisma.models.findMany()).map(async e=>{try{let[t,r,n]=await Promise.all([(0,A.getOpenPositions)(e.lighterApiKey,e.accountIndex,e.id,{fallbackToSimulator:!0}),E.prisma.toolCalls.findMany({where:{toolCallType:x.ToolCallType.CREATE_POSITION,invocation:{modelId:e.id}},orderBy:{createdAt:"desc"},take:50}),(0,R.getPortfolio)({apiKey:e.lighterApiKey,accountIndex:e.accountIndex,id:e.id,modelName:e.openRoutermodelName,name:e.name,invocationCount:e.invocationCount,totalMinutes:e.totalMinutes},{fallbackToSimulator:!0})]),i=(0,w.buildDecisionIndex)(r.map(e=>({id:e.id,createdAt:e.createdAt,toolCallType:e.toolCallType,metadata:(0,P.safeJsonParse)(e.metadata,null)}))),a=t.reduce((e,t)=>{let r=(0,C.normalizeNumber)(t.unrealizedPnl);return e+(r??0)},0);return{modelId:e.id,modelName:e.name,modelLogo:e.openRoutermodelName,positions:(t||[]).map(e=>{let t=e.symbol?.toUpperCase?.()??e.symbol,r=t?i.get(t):void 0,n=r?{target:r.profitTarget,stop:r.stopLoss,invalidation:r.invalidationCondition}:null,a=r?.status??(r?.result?.success===!0?"FILLED":r?.result?.success===!1?"REJECTED":null);return{...e,signal:r?.signal??e.sign,leverage:r?.leverage??e.leverage,confidence:r?.confidence??null,quantity:e.quantity,exitPlan:n,lastDecisionAt:r?.createdAt?.toISOString?.()??null,decisionStatus:a}}),totalUnrealizedPnl:a,availableCash:n.availableCash}}catch(t){return console.error(`Error fetching positions for ${e.id}`,t),{modelId:e.id,modelName:e.name,modelLogo:e.openRoutermodelName,positions:[],totalUnrealizedPnl:0,availableCash:0}}}))}async function S(){try{let e=await N();return b.NextResponse.json({positions:e})}catch(e){return console.error("Error fetching positions:",e),b.NextResponse.json({error:"Failed to fetch positions"},{status:500})}}e.s(["GET",()=>S],407041);var T=e.i(407041);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/positions/route",pathname:"/api/positions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/positions/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:O,workUnitAsyncStorage:F,serverHooks:_}=I;function k(){return(0,n.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:F})}async function M(e,t,n){I.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let b="/api/positions/route";b=b.replace(/\/index$/,"")||"/";let x=await I.prepare(e,t,{srcPage:b,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:A,params:R,nextConfig:w,parsedUrl:E,isDraftMode:P,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:S,revalidateOnlyGenerated:T,resolvedPathname:O,clientReferenceManifest:F,serverActionsManifest:_}=x,k=(0,s.normalizeAppPath)(b),M=!!(C.dynamicRoutes[k]||C.routes[O]),U=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,E,!1):t.end("This page could not be found"),null);if(M&&!P){let e=!!C.routes[O],t=C.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await U();throw new y.NoFallbackError}}let q=null;!M||I.isDev||P||(q="/index"===(q=O)?"/":q);let L=!0===I.isDev||!M,D=M&&!L;_&&F&&(0,o.setReferenceManifestsSingleton)({page:b,clientReferenceManifest:F,serverActionsManifest:_,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:_})});let H=e.method||"GET",j=(0,a.getTracer)(),K=j.getActiveScopeSpan(),$={params:R,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>I.onRequestError(e,t,n,N)},sharedContext:{buildId:A}},z=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let o=async e=>I.handle(G,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${b}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),s=async i=>{var a,s;let u=async({previousCacheEntry:r})=>{try{if(!l&&S&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(i);e.fetchMetrics=$.renderOpts.fetchMetrics;let s=$.renderOpts.pendingWaitUntil;s&&n.waitUntil&&(n.waitUntil(s),s=void 0);let u=$.renderOpts.collectedTags;if(!M)return await (0,f.sendResponse)(z,B,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,n=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:S})},N),t}},c=await I.handleResponse({req:e,nextConfig:w,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:l});if(!M)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(s=c.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",S?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&M||d.delete(g.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,f.sendResponse)(z,B,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};K?await s(K):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${b}`,kind:a.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},s))}catch(t){if(t instanceof y.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:S})}),M)throw t;return await (0,f.sendResponse)(z,B,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>k,"routeModule",()=>I,"serverHooks",()=>_,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>F],387849)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a6c23bbf._.js.map